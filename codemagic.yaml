workflows:
  develop-workflow:
    name: Develop Workflow
    max_build_duration: 60
    environment:
      vars:
        GRADLE_PATH: /Users/builder/programs/gradle-5.6.4/bin
        ANDROID_SDK_ROOT: /Users/builder/programs/android-sdk-macosx
    triggering:
      events:
        - push
        - tag
      branch_patterns:
        - pattern: develop
          include: true
          source: true
    scripts:
     - npm install
     - sudo npm install -g cordova
     - cordova platform add android
     - echo $GRADLE_PATH
     - export PATH=$GRADLE_PATH:$PATH
     - echo $PATH
     - export PATH=$GRADLE_PATH:$PATH  
     - cordova build android
    artifacts:
     - platforms/android/app/build/outputs/apk/**/*.apk
     - platforms/android/app/build/outputs/apk/**/*.aab
     - $FCI_BUILD_DIR/*.zip
  release-workflow:
    name: Release Workflow
    max_build_duration: 60
    environment:
      vars:
        GRADLE_PATH: /Users/builder/programs/gradle-5.6.4/bin
        ANDROID_SDK_ROOT: /Users/builder/programs/android-sdk-macosx
        ZIPALIGN: /Users/builder/programs/android-sdk-macosx/build-tools/29.0.3/zipalign
        RELEASE_DIR: /Users/builder/clone/platforms/android/app/build/outputs/apk/release
        CM_KEYSTORE: Encrypted(Z0FBQUFBQmZGcFlKUmdmUFE4T3pDdEowQTJRTzg2S0dqSGI3YWhSS2ZqR2VGWmtqQ3B0cHpPXzdXTDJVYnRuTUhtZnRIVnpiQ2lGNXVZUmlNcUZpX3paNm02QVdLYkUyeExNMF9RaEluSWFuaU03TWxWM0FxbVNvS0Z3RFdOT1ZMOFZsdnVHeEN3U2lXclRNOTdFM0NjODc4Vk5PVktGelYwZG1hdjRhOXNYU1VlQm5VWjJYcDNfcV8tb2RobklqVXNkMjMxdmxubkxCTkVjRG9ZTlZjWVpBWXBEWHlZQVdqZ2Q2VDVYOVVWa0xVX3RJR0lDSW9PT2xHSzFUR2Z6clJNd0VPX0pieHA3aml5SjRyT1ZtNEJha0R5UWpZcXh2S0h0VXVPcnhSdjdaMG5ZSDZPTlEwcUpOVnphYjZDY2ZJUk0zaWU0ZjliakJVTnZzT01sUmwyR0F3Mjh4dXhfUXpSOERVSExUeWVwVzNVQVU0X3RIQUl0ZjU1QzE2RjJlUE1EQUZreDBQMnl5b3ItX24zbHJiTVpOS053RzB4ZzJzeXBMRTMwWHVBWkY1eEQxQzFHUER4UEwzS2NuMkg1VTZfNlZvbXhfXzc4LXQ2UUVtNnY0dF96bUljV1dFTTNPOGdMY3BIMEpReTVjdGZMbXYxUHlYbzU0dG0wTHhkVVhjcHlmRlFtUktMT1lkanpFOTlXaG5ORllYQ0xnZTRld3BVRkdSblQ3LWJ2UWdKQ1FvU0Nod3VKNGU2LXFaRVVCN2Y5UHNwSEVtcE1fZ0l2STZBM21CMnBjd2NjUjJ5bERPbVlWbHVDcmJhNXAxNDFBbG9tQVptNkFKcG5CNGNHbnlESUkxUk5kNnhQU25Yb012N2VGVTJYZjFUMHJxLUpvOE1qM0tZOVRLNThuZHk5T0RnQ29vajkyZTE2ekJlbGJUSnFqN1JMeXhZN3BGeWFjd2cxY3paTlE4R3RPcmgwR1dmVWlKWmpYRnBOd2s2MUpiZVBUZ0tqYTZCWGhmTEJoUVBnTFFNMVBrWFBWdTNnRVVSdnYwRmFnQmR6NVNhVTVBR1htMlM1VU5LNzJmQlZwQ2dSUFlsa1lvdlJWbnAweWpTa2RnUl9lc1pZbUc4aHFMYVJ3Njg2N0JPQmZtUXgxcl9jS19qaUY4LU9KQ0pranpZY3FjTEs3ajNZZ1YxZy1wMGU0MkRFWk9wWXBPZWdSUUdTZnZwMnFDOXhsRV9hRzkyTE5EWVN5Z25COVh0V3Nia1draWx1Uk9VVWFOQ3hWUHNHYlY5OEV1WlE3eURtUnpqUlpBOGFIdm8tQVhlYUExMTV3VkowLUdheXR1SnJWMEVXSW9YbGRXMXl0YTE3YXk5bnBMNzZCUmdQNGxBQ3R2NmQ3NzRRYlF3RTdYa28xVmtzTnkweXpxVVJrUHJNZU1jRnZFcjE2QkYtSktkaWs1QUVpQlZNSmFOWnotNXhYWk5fYmFOYlQxLUxiME9vWW5iQlJCQlREU3RuV1dIMmJnS0wxRWNHNlZ0OWhGOTRBR0laSDc5MmdOUTNmRTBRVXZUdE9nZVpwdVpnUmxobjY4Mkd1TDFYZUR4SmxacDZlX29ZZC00U2k3Mm9tZTJFZEl3dzVUdE1wNHc3OUVXWUVIV3gtYU5NSFZ2Y1UtaHYwbWRqN0huNWFaeG1UcG8yQ3JnajFpTEt3S2VPVWpaUjJkX2d5QTR0RnpUdjk1Y3BwYUtnUFQ4QnVPUUo5OXNUQk1QRnFJakdJcTJSSDRDc0VkSjBGZnlnT3lHOUUxU3NDZ05oOWNyXzYyekN0eFNuM29Xb3B5TjJ0QzlCeHd2VGJpQWpPYWRYRzFvSjdtaHFhTmE2VjlyMHZhOGxvR2lDZFpnYnV3U25Fb1hRQVZ0MlJ0VkdpQTNlZ3ZxVGl1YTZXNktGU1lIeG41eXF3anNidGRtbVdYWk1JcHNfcXotMkFlMDdzWWNjS2Vhd2JMZmEtSldUakhqSkMzNF9rNDRiX290UzM1QjNRdVdsTGRGXzQ4RmlNM2lhLXJudzEwVzZlTWNuS1ZuT3JwaDh6ZjEwMTFJUldzcWZ5d1lRTGtWU05mdE5mYUwxQy1sbjdlWlV3eVdnZkxiN09ReWZUSXV1bDlPQ1djbjN0d2k4ZjAzbXo3Wld5d0xDQUhpbUwxSy1ZZTFMWU9PQ0NwZG5QNkpULUVWM0Jod29tdjFINnVlTExNbV9HY016ZWE1SUw1a1JfZnJPalJ4NTcwWUpJV2xCMnpGQ3VyM0lfS28ycjl6NXpjMlFxUzhlZ01Ya0Jablh4QTR5NllGSVlfb0p5a3pGaThtV3hVT2NydVFFRWtURS1ydW5SaGk0YmtVbWJBSXhMc05HQW9ma2MzTzdkcHloLWNLRGwySjc5b2lLSU9neFdwSXdfbTNWdjVYcU43YkxTZUtZYVU1VFR6OGlGZEliWW45cGdiaVF3RkM5SDlqMUhuZDEzNzRTZlVxeXRJOEdXaFBSa2dSWHRuUGJzS2RCMzFkVDhRcjhhaFJXZHFwVGlScm92VzRxUVdfVDVqUFRnZE8zZ0hMR3gwOFc4aTkzMFpoSGotNEY2NnU0aVhZckV0c1hJME10em1mUjA3SG8xWW1QOWYyekV2elR2ZElzdUhKQ0dVTkdCMG9ERE9LUlpidzk3LW5fZldFemtpd1JycE0tYktRZkFvM2JsYm1XdEJJZTZUbG1wcnpmTXN5VkRmaFgyczZYZm1kcXJZV3V1VG9pSmZYcVRhYm9oYUVKUVlNdWxHU1VYSkkzamVjd3hZN1VjUkd0Q3dCbXlfSmNXcFByVjh2d1Y1eEk5dDJORERfcGpQSUVBZXNQcDA5SkNveUZXbXVGVzdWbjhYdnhWalRIQ01Id2h4YlhzTTFHLVlJdVJJLVRnU21mRGJvSzNGUVdXNHotNHdjNlF5ZWFMZ1J6WlNCVkRSZ291U24xcVFMU3Ixamg3YXRpalRlSnQ5dU1zcFo2azFDV0NldDBQckoyZVplZUxjTzdKcE4tSldrbmtDRkYtbGFjQnBJQ2NSUG1rN0g4c1M1MTFKdm1vSVVuOUxXRmdGanVVZnFFV0JCM1g0MzU1a01WdjZ2bmp3OXRvS2c0UFNzeHMxNFFldnQwbnZ6QWg2RnVKSlJLaUJmU1FQS0g3QXFxR1NuOUR1SnN2d1RieUZQVEItU0xTM3RPbnNoLUpyb2Z3djZOZXgzTENTUTNJT2pSRW0zNVFTeThuakE3R2FJUWJkQkZENW9oTlBPWjMyNV9mZTctUTRGWmp1NE5PQVNnSXdkejNYS2tWRUEwOXN3XzBTTFRTaGhUZVFmNE05ZzN4a3FlM3VFWjUzaDhuTVZGbjRvNmN3VHlfT0JqUUtrbW10T1RpUllRZkZYNWlZVmRLX0NYTjNpYXEzRThBSFBCdl93RF9xZUlKbnRYU3hpdHIzUFRfTTVKQ1I5SGZkMzdxX2RNU25NcWw1TzZFUWM2N2VmN0dtN3NhTXRJUU9VQ3FEdHJqQlpubXA2VHlnc2pZb01YQnE0QjJEZDdXWjdaODZXeDU1czVHOHFUNW9wTW40ZFY5Y21mbFIwVXhIUjA1bHd6MFlnWGRTbmJjandOcWY1Ukk2WlpHeDdQSmpLVWViV3phQ21aVVRuc2lYa0RVX1ZvY25OWXdKRnBfTnl2ME9xRmlXbTNMQlVZQzBEYldBbnpBWlloampnNy0zNkxvRkdOSTV5cGNlbF8zazF4bmlaYVVnM2pmV2c2bGV3M18xMTdyU0M1YjNNUHRNM2Z6VFF3NWVKNm5kbGJVWUZObHBIMm0xSXJ5anRCTEIzaERvSWFvMFltUnYwQlYxM2NONVhrT2pEbW9NYWdXcGpMN2pLQjNvQlFLZFN6T2FxNnZVcGNROWVqVHhSVGlGMWM4UGFVUEdMTlBEb0FNY1VwcUUyalE2cFpqNVEtQmhtandDZ0pZR2xfSU5ZaUhGR1pRa216bVd4bndLOUFXVDhWNXFVbEtrN3lVdE5FLThWNklFYVRMcU9KTjJITlJ5eVVfRXBRZkRDMnBYY043RUtQeG1FNlY0eTFCTzdZLWc3SG5vVXVxdm5XUVlodUZHdS1zQUE5NE5fUUoxT3JHUFdFZGxxeVZpS0tiYW5MZUxXTDR4cXhldGlQMUVBV0lXbkhqYVpxZnlxY3p0NzdZOGZLQ0FNZS1oNkM4S3luT1VVRVdoVVhXRFBZNWxza2hlcGlfZ0VXNUVwamFMNDg2Z1JZb1diQlk4djFmaVBxemVIaE9lV1p6TFRZM0djME9rdXFKYWFuUkI3RFlVbnFwZnl0bUZUdkdVWVFSYnRqd3AzWFJrNHVYTFhqcUVBOGNCajBUZ0NXbDBsdU91V3pQWngxZmx4NENPdjBPV3NfeENNd3JSdmg0dmxTeU5GLU5WcDRFVEo2TXhsLXl0UUpUUlRzTGFqLUtVS3N1QmJTa1M2aTRRcWtaVTUtTTZhcDIwNmU4VUUteEZCSWZvOV9qb1FpNnNsY1BObEVOQ2YxVlFuOWl6SDJEYTUwanpvVG96N1FOUS1WWF9GN0R6OVV5VzFRUWdLZ0RWU19WOW12eEY0RTdxcEJsb3VVUFllM1diNkF0NF9aMWxtYm5uek9SeEN5RnZTUVRYYV9FWjZkb1Y5a2duNnpLU3NjSUNmRDhreVdyZ2thd0RvMElNM3FmRGRMNVplTFJSYjZud2VUbWRWeHFvamUwVEZyWk1TRGE0ZXZidjE5WHJXSUV5Q2g0UHg0NmVtYkdsYXR3MFRickhYZ0h6Um4tNWhzdk5pYTRGZ3JLVGpyeTVxcGFCTVJMdHV1NVVYUjZsYUhsZDUxR2VJRWVhN3c4ZUo3RmYxZFloVklSQVlmUnljMkdTVlA1WmtYckFmSmVBVkpfZ1ZFNWxxdHM1bkJ0RGo3VDlUdl9TMXNTM0ZyY1BNNERhOE12amVKTDhmTDRvVUFXd21ZRmhGT0pySkc3SGFYcWVnYkdiRzBBb1M3b3VxWDZXR1FybjNULTBra1hxM3JaRlVZbnBObVh4Nzd5Y2VmOGdnd3hDM0dENFMySk1wWnV0NjRxQl8waW9hYWVPYk9vRU1mQ1BKdW1wRnFSQzV6eVVRa05yeUdtV0JiWUJXeU0wQXFmV19tT1JUMWRFRGJucThUMjFvN3lYUWZKMnpZNDg2WVJHcmFYWW9NZTBxOTVMREVKeTJEa0hLWElEM0RSdW5fQ1hqM0dQUjVZRm9qZWoyQUh4YlFHWWxiWkZsN2g3WmV1Z2Zfa3dCZzVUQjllazFmcW1KWFZBbE5hOXAxZ19TQWF0RUJaOVpGdEpVZFgxdDhmTk1DbEZFZEM0SFI2UHlTRVlDeXZMV3gxcE96LUZ5VWFKTUFUVU5XRVJhTkMzMXZVZUM2ZUNoVG5ocEtnU0tRSnhCc1pCcmFPTG5taFo0Zz0=)
        CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmZGcFlKbDU2NjFoeDJMR29uSFJzTi1jN1VWTmtwNWxHM1ZYLVlLUWFyR1BsaFV6UWM4RTVYclRvZnZVRnNENDUtVlN6YUwtM2VrNDliUTg3eWcweUF5QzdVcXc9PQ==)
        CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmZGcFlKdHAxb3NETl9KRnZmaF9TSEFsYmxQd1RfQ00xbER6ZVJQaG5hQmU0V2tsZ0JtSEEwdy12aUxuemthX2Y1STZhb2lzTk5zTTdEcER3NmdQMUpKUXo3Y0E9PQ==)
        CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmZGcFlKQlBwM2dCbU9HbnhnckZ5MUlPU0F1c2x3akdwNkwxVE1qbENYQzRoejdRSFl1NmNvcTdDMVM4aFB3YUxyWk9mTkRIYndBZzQwd01aaGZ0anZiVFdQVmc9PQ==)
    triggering:
      events:
        - push
        - tag
      branch_patterns:
        - pattern: master
          include: true
          source: true
    scripts:
     - npm install
     - |
        # set up key.properties
        echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.keystore
     - sudo npm install -g cordova
     - cordova platform add android
     - echo $GRADLE_PATH
     - export PATH=$GRADLE_PATH:$PATH
     - echo $PATH
     - export PATH=$GRADLE_PATH:$PATH && cordova build android --release
     - jarsigner -keystore /tmp/keystore.keystore -storepass $CM_KEYSTORE_PASSWORD -keypass $CM_KEY_ALIAS_PASSWORD $RELEASE_DIR/app-release-unsigned.apk $CM_KEY_ALIAS_USERNAME -digestalg SHA1
     - $ZIPALIGN -v -f 4 $RELEASE_DIR/app-release-unsigned.apk $RELEASE_DIR/app-release-signed_$BUILD_NUMBER.apk
    artifacts:
     - platforms/android/app/build/outputs/apk/release/**/*.apk
     - platforms/android/app/build/outputs/apk/release/**/*.aab
     - $FCI_BUILD_DIR/*.zip